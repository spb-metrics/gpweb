SET FOREIGN_KEY_CHECKS=0;
UPDATE versao SET versao_codigo='8.0.31'; 
UPDATE versao SET ultima_atualizacao_bd='2012-08-12'; 
UPDATE versao SET ultima_atualizacao_codigo='2012-08-12'; 
UPDATE versao SET versao_bd=119;  

RENAME TABLE projeto_ata_acao TO ata_acao;
RENAME TABLE projeto_ata TO ata;
RENAME TABLE projeto_ata_usuarios TO ata_usuarios;
RENAME TABLE projeto_ata_pauta TO ata_pauta;

ALTER TABLE ata DROP FOREIGN KEY projeto_ata_fk;
ALTER TABLE ata DROP FOREIGN KEY projeto_ata_fk5;
ALTER TABLE ata DROP FOREIGN KEY projeto_ata_fk2;
ALTER TABLE ata_acao DROP FOREIGN KEY projeto_ata_acao_fk;
ALTER TABLE ata_acao DROP FOREIGN KEY projeto_ata_acao_fk1;
ALTER TABLE ata_usuarios DROP FOREIGN KEY projeto_ata_usuarios_fk;
ALTER TABLE ata_usuarios DROP FOREIGN KEY projeto_ata_usuarios_fk1;
ALTER TABLE ata_pauta DROP FOREIGN KEY  projeto_ata_pauta_fk;

ALTER TABLE ata DROP KEY projeto_ata_projeto;
ALTER TABLE ata DROP KEY projeto_ata_tarefa ;
ALTER TABLE ata DROP KEY projeto_ata_responsavel;

ALTER TABLE ata CHANGE COLUMN projeto_ata_projeto ata_projeto INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_tarefa ata_tarefa INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_responsavel ata_responsavel INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_numero ata_numero INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_data_inicio ata_data_inicio DATETIME DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_data_fim ata_data_fim DATETIME DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_local ata_local TEXT;
ALTER TABLE ata CHANGE COLUMN projeto_ata_relato ata_relato TEXT;
ALTER TABLE ata CHANGE COLUMN projeto_ata_proxima_data_inicio ata_proxima_data_inicio DATETIME DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_proxima_data_fim ata_proxima_data_fim DATETIME DEFAULT NULL;
ALTER TABLE ata CHANGE COLUMN projeto_ata_proxima_local ata_proxima_local TEXT;
ALTER TABLE ata CHANGE COLUMN projeto_ata_cor ata_cor VARCHAR(6) DEFAULT 'ffffff';
ALTER TABLE ata CHANGE COLUMN projeto_ata_acesso ata_acesso INTEGER(100) UNSIGNED DEFAULT '0';
ALTER TABLE ata CHANGE COLUMN projeto_ata_id ata_id INTEGER(100) UNSIGNED NOT NULL AUTO_INCREMENT;   
ALTER TABLE ata ADD KEY ata_projeto (ata_projeto);
ALTER TABLE ata ADD KEY ata_tarefa (ata_tarefa);
ALTER TABLE ata ADD KEY ata_responsavel (ata_responsavel);
ALTER TABLE ata ADD CONSTRAINT ata_fk FOREIGN KEY (ata_projeto) REFERENCES projetos (projeto_id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE ata ADD CONSTRAINT ata_fk5 FOREIGN KEY (ata_tarefa) REFERENCES tarefas (tarefa_id) ON DELETE SET NULL ON UPDATE CASCADE;
ALTER TABLE ata ADD CONSTRAINT ata_fk2 FOREIGN KEY (ata_responsavel) REFERENCES usuarios (usuario_id) ON DELETE SET NULL ON UPDATE CASCADE;

ALTER TABLE ata_acao DROP KEY projeto_ata_id;
ALTER TABLE ata_acao DROP KEY projeto_ata_acao_responsavel;
ALTER TABLE ata_acao CHANGE COLUMN projeto_ata_id ata_id INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata_acao CHANGE COLUMN projeto_ata_acao_responsavel ata_acao_responsavel INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata_acao CHANGE	COLUMN projeto_ata_acao_data ata_acao_data DATETIME DEFAULT NULL;
ALTER TABLE ata_acao CHANGE COLUMN projeto_ata_acao_texto ata_acao_texto TEXT;
ALTER TABLE ata_acao CHANGE COLUMN projeto_ata_acao_ordem ata_acao_ordem INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata_acao CHANGE COLUMN projeto_ata_acao_tipo ata_acao_tipo VARCHAR(20) DEFAULT NULL;
ALTER TABLE ata_acao CHANGE COLUMN projeto_ata_acao_id ata_acao_id INTEGER(100) UNSIGNED NOT NULL AUTO_INCREMENT;
ALTER TABLE ata_acao ADD KEY ata_id (ata_id);
ALTER TABLE ata_acao ADD KEY ata_acao_responsavel (ata_acao_responsavel);
ALTER TABLE ata_acao ADD CONSTRAINT ata_acao_fk1 FOREIGN KEY (ata_acao_responsavel) REFERENCES usuarios (usuario_id) ON DELETE SET NULL ON UPDATE CASCADE;
ALTER TABLE ata_acao ADD CONSTRAINT ata_acao_fk FOREIGN KEY (ata_id) REFERENCES ata (ata_id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE ata_usuarios CHANGE COLUMN projeto_ata_id ata_id INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata_usuarios DROP KEY projeto_ata_id;
ALTER TABLE ata_usuarios ADD KEY ata_id (ata_id);
ALTER TABLE ata_usuarios ADD CONSTRAINT ata_usuarios_fk FOREIGN KEY (ata_id) REFERENCES ata (ata_id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE ata_usuarios ADD CONSTRAINT ata_usuarios_fk1 FOREIGN KEY (usuario_id) REFERENCES usuarios (usuario_id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE ata_pauta CHANGE COLUMN projeto_ata_pauta_id ata_pauta_id INTEGER(100) UNSIGNED NOT NULL AUTO_INCREMENT;
ALTER TABLE ata_pauta CHANGE COLUMN projeto_ata_id ata_id INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata_pauta CHANGE COLUMN projeto_ata_pauta_texto ata_pauta_texto TEXT;
ALTER TABLE ata_pauta CHANGE COLUMN projeto_ata_pauta_ordem ata_pauta_ordem INTEGER(100) UNSIGNED DEFAULT NULL;
ALTER TABLE ata_pauta CHANGE COLUMN projeto_ata_pauta_tipo ata_pauta_tipo VARCHAR(20)  DEFAULT NULL;
ALTER TABLE ata_pauta DROP KEY projeto_ata_id;  
ALTER TABLE ata_pauta ADD KEY ata_id (ata_id);  
ALTER TABLE ata_pauta ADD CONSTRAINT ata_pauta_fk FOREIGN KEY (ata_id) REFERENCES ata (ata_id) ON DELETE CASCADE ON UPDATE CASCADE;


UPDATE artefatos_tipo SET artefato_tipo_campos=0x613A393A7B733A353A2263616D706F223B613A31383A7B693A313B613A323A7B733A343A227469706F223B733A343A226C6F676F223B733A353A226461646F73223B733A31313A2270726F6A65746F5F636961223B7D693A323B613A323A7B733A343A227469706F223B733A393A226361626563616C686F223B733A353A226461646F73223B733A31313A2270726F6A65746F5F636961223B7D693A333B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31343A2270726F6A65746F5F636F6469676F223B7D693A343B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A31323A2270726F6A65746F5F6E6F6D65223B7D693A353B613A323A7B733A343A227469706F223B733A343A2264617461223B733A353A226461646F73223B733A31353A226174615F646174615F696E6963696F223B7D693A363B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A31353A226174615F646174615F696E6963696F223B7D693A373B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A31323A226174615F646174615F66696D223B7D693A383B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A393A226174615F6C6F63616C223B7D693A393B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31373A226174615F7061727469636970616E746573223B7D693A31303B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A393A226174615F7061757461223B7D693A31313B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A31303A226174615F72656C61746F223B7D693A31323B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A393A226174615F61636F6573223B7D693A31333B613A323A7B733A343A227469706F223B733A343A2264617461223B733A353A226461646F73223B733A32333A226174615F70726F78696D615F646174615F696E6963696F223B7D693A31343B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A32333A226174615F70726F78696D615F646174615F696E6963696F223B7D693A31353B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A32303A226174615F70726F78696D615F646174615F66696D223B7D693A31363B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A31373A226174615F70726F78696D615F6C6F63616C223B7D693A31373B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31373A226174615F70617574615F70726F78696D61223B7D693A31383B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31353A226174615F617373696E617475726173223B7D7D733A31313A226D6F64656C6F5F7469706F223B733A323A223133223B733A363A2265646963616F223B623A303B733A393A22696D7072657373616F223B623A303B733A393A226D6F64656C6F5F6964223B693A303B733A393A2270617261677261666F223B693A303B733A31353A226D6F64656C6F5F6461646F735F6964223B693A303B733A363A226D6F64656C6F223B4E3B733A333A22716E74223B693A31383B7D WHERE artefato_tipo_id=13;  
UPDATE artefatos_tipo SET artefato_tipo_campos=0x613A393A7B733A353A2263616D706F223B613A31383A7B693A313B613A323A7B733A343A227469706F223B733A343A226C6F676F223B733A353A226461646F73223B733A31313A2270726F6A65746F5F636961223B7D693A323B613A323A7B733A343A227469706F223B733A393A226361626563616C686F223B733A353A226461646F73223B733A31313A2270726F6A65746F5F636961223B7D693A333B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31343A2270726F6A65746F5F636F6469676F223B7D693A343B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A31323A2270726F6A65746F5F6E6F6D65223B7D693A353B613A323A7B733A343A227469706F223B733A343A2264617461223B733A353A226461646F73223B733A31353A226174615F646174615F696E6963696F223B7D693A363B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A31353A226174615F646174615F696E6963696F223B7D693A373B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A31323A226174615F646174615F66696D223B7D693A383B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A393A226174615F6C6F63616C223B7D693A393B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31373A226174615F7061727469636970616E746573223B7D693A31303B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A393A226174615F7061757461223B7D693A31313B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A31303A226174615F72656C61746F223B7D693A31323B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A393A226174615F61636F6573223B7D693A31333B613A323A7B733A343A227469706F223B733A343A2264617461223B733A353A226461646F73223B733A32333A226174615F70726F78696D615F646174615F696E6963696F223B7D693A31343B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A32333A226174615F70726F78696D615F646174615F696E6963696F223B7D693A31353B613A323A7B733A343A227469706F223B733A31323A22686F72615F64655F64617461223B733A353A226461646F73223B733A32303A226174615F70726F78696D615F646174615F66696D223B7D693A31363B613A323A7B733A343A227469706F223B733A31333A22626C6F636F5F73696D706C6573223B733A353A226461646F73223B733A31373A226174615F70726F78696D615F6C6F63616C223B7D693A31373B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31373A226174615F70617574615F70726F78696D61223B7D693A31383B613A323A7B733A343A227469706F223B733A31343A226C697374615F657370656369616C223B733A353A226461646F73223B733A31353A226174615F617373696E617475726173223B7D7D733A31313A226D6F64656C6F5F7469706F223B733A323A223133223B733A363A2265646963616F223B623A303B733A393A22696D7072657373616F223B623A303B733A393A226D6F64656C6F5F6964223B693A303B733A393A2270617261677261666F223B693A303B733A31353A226D6F64656C6F5F6461646F735F6964223B693A303B733A363A226D6F64656C6F223B4E3B733A333A22716E74223B693A31383B7D WHERE artefato_tipo_id=27;